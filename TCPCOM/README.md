# TCPCOM

一个功能强大的 TCP 通信工具集，支持多种通信协议和工业设备连接。

## 项目简介

TCPCOM 是一个基于 C# .NET Framework 4.0 开发的 TCP 通信工具，提供了完整的 TCP Socket 通信、Modbus TCP 协议支持以及多种 PLC 设备的连接功能。适用于工业自动化、设备调试、网络通信测试等场景。

## 主要功能

### 1. TCP Socket 通信
- **TCP 服务器**
  - 支持多客户端同时连接
  - 实时显示客户端连接状态
  - 支持群发消息到所有客户端
  - 自动启动监听功能
  - 连接状态可视化（TreeView）
  
- **TCP 客户端**
  - 快速连接到服务器
  - 实时接收和发送消息
  - 自动连接功能
  - 连接状态监控

### 2. Modbus TCP 协议支持
- **Modbus TCP 服务器**
  - 支持标准 Modbus TCP 功能码
    - 0x01: 读取线圈状态
    - 0x02: 读取离散输入状态
    - 0x03: 读取保持寄存器
    - 0x04: 读取输入寄存器
    - 0x05: 写单个线圈
    - 0x06: 写单个保持寄存器
    - 0x0F: 写多个线圈
    - 0x10: 写多个保持寄存器
  - 支持多客户端连接
  - 数据区域可视化（线圈、离散输入、保持寄存器、输入寄存器）
  - 实时数据监控和修改

- **Modbus TCP 客户端**
  - 完整的 Modbus 功能码支持
  - 灵活的数据读写操作
  - 事务标识符自动管理
  - 异常响应处理

### 3. PLC 设备支持
- **基恩士 PLC (Keyence PLC)**
  - 默认端口 8501
  - 快速连接和通信
  
- **三菱 PLC (Mitsubishi PLC)**
  - 支持三菱 PLC 通信协议
  - 设备连接和监控

### 4. 高级功能
- **定时发送**
  - 支持自定义发送间隔（1-60000ms）
  - 可设置发送次数（1次、10次、100次、1000次、无限次）
  - 暂停/恢复功能
  - 发送进度显示

- **多实例管理**
  - 通过 TreeView 管理多个连接实例
  - 支持同时创建多个服务器/客户端
  - 实时显示连接状态
  - 便捷的实例删除功能

- **消息监控**
  - 实时显示发送/接收的消息
  - 时间戳记录
  - 消息列表自动滚动
  - 支持清空消息记录

## 技术特性

- **开发环境**: C# .NET Framework 4.0
- **界面框架**: Windows Forms
- **网络通信**: System.Net.Sockets
- **多线程支持**: 异步接收和线程安全的消息显示
- **异常处理**: 完善的异常捕获和错误提示

## 项目结构

```
TCPCOM/
├── MainForm.cs                    # 主界面，管理所有连接实例
├── ucSocketServer.cs              # TCP 服务器用户控件
├── ucSocketClient.cs              # TCP 客户端用户控件
├── ucModbusTCPServer.cs           # Modbus TCP 服务器用户控件
├── ucModbusTCPClient.cs           # Modbus TCP 客户端用户控件
├── ucKeyencePLC.cs                # 基恩士 PLC 用户控件
├── ucMitsubishiPLC.cs             # 三菱 PLC 用户控件
├── ModbusConnectionClient.cs      # Modbus 连接客户端处理
├── DialogCreate*.cs               # 各种创建对话框
└── Properties/                    # 项目属性和资源
```

## 使用说明

### 创建 TCP 服务器
1. 在主界面左侧树形结构中选择 "TCP Server"
2. 点击 "创建" 按钮
3. 输入服务器 IP 地址（可选，留空或 0.0.0.0 绑定所有接口）和端口号
4. 服务器将自动启动监听

### 创建 TCP 客户端
1. 选择 "TCP Client"
2. 点击 "创建" 按钮
3. 输入服务器 IP 地址和端口号
4. 客户端将自动连接到服务器

### 创建 Modbus TCP 服务器
1. 选择 "Modbus TCP Server"
2. 点击 "创建" 按钮
3. 输入端口号（默认 502）
4. 服务器启动后，可以通过数据视图查看和修改 Modbus 数据区域

### 创建 Modbus TCP 客户端
1. 选择 "Modbus TCP Client"
2. 点击 "创建" 按钮
3. 输入 Modbus 服务器 IP 地址和端口号
4. 选择功能码和设置参数进行读写操作

### 定时发送功能
1. 在消息输入框中输入要发送的内容
2. 选择发送次数（1、10、100、1000 或无限）
3. 设置发送间隔（毫秒）
4. 点击 "开始" 按钮启动定时发送
5. 支持暂停和停止操作

### 删除实例
1. 在树形结构中选择要删除的实例节点
2. 点击 "删除" 按钮
3. 确认删除操作

## 系统要求

- Windows 操作系统
- .NET Framework 4.0 或更高版本
- Visual Studio 2010 或更高版本（用于编译）

## 编译说明

1. 使用 Visual Studio 打开 `TCPCOM.csproj`
2. 选择 Debug 或 Release 配置
3. 生成解决方案
4. 可执行文件位于 `bin/Debug/` 或 `bin/Release/` 目录

## 注意事项

- TCP 服务器默认最多允许 10 个客户端连接队列
- Modbus TCP 默认端口为 502
- 基恩士 PLC 默认端口为 8501
- 定时发送功能需要保持连接状态
- 删除实例前请确保已断开连接

## 许可证

本项目采用开源许可证，欢迎自由使用和修改。

## 作者信息

- **作者**: Alex Hu
- **邮箱**: 254343362@qq.com

## 更新日志

### 最新版本
- 修复了 Modbus TCP 服务器中地址范围检查的警告
- 优化了代码结构和异常处理
- 改进了用户界面交互体验

## 贡献

欢迎提交 Issue 和 Pull Request 来帮助改进这个项目。

## 致谢

感谢所有使用和贡献本项目的用户。

---

**注意**: 本项目仅供学习和测试使用，在生产环境中使用前请进行充分测试。

